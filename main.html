<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="main.css" />
  <title>Document</title>
</head>


<body onload="onload()">

<!--header part -->

    <header>
      <div class="logo">CEEThip<span>.</span></div>
      <div class="question">
        <h3 id="user-name"></h3>
        <button id = "MyQuestion" onclick="MyQuestion()">My Question</button>
        <button id = "CreatQuestion" onclick="CreateQuestion()">Create Question</button>
      </div>
    </header>

<!-- home part-->
    <div id="login">
    <div class="page home-page open">
      <link rel="stylesheet" href="home.css"/>
      <section class="home" id="home">

        <div class="content">
            <h3>Welcome to CEEThip<span>.</span></h3>
            <span>question and answer platform that help students with online learning</span>
            <p>แพลต์ฟอร์มเว็บบอร์ดที่ให้นักเรียนสามารถตั้งกระทู้ถามข้อสงสัยเกี่ยวกับรายวิชา 
                และสามารถให้อาจารย์หรือนักเรียนคนอื่นเข้ามาตอบคำถามได้ </p>
            <p>ถ้าอยากเป็นส่วนหนึ่งกับเรา โปรดใส่ชื่อ</p>
            <form style="align-items: center; ">
                <input type="text" class = "nnninputusername" id="name" placeholder="Your name.." />
                <button onclick="changeUsername(); ">Enter</button>
            </form>
        </div>
      
        <div class="image">
            <img src="working3.png" alt="Working images">
        </div>
    </div>
  </div>


</section>

<!-- web board part -->

    <div class = "page main-page">  
      <section id="{{SUBJECT}}" class = "subject hide" > 
        <h3 class="title">{{SUBJECT}}<span>.</span></h3>
        <br> 
        <table class="tab-data">
            <thead>
              <tr class="head-table">
                <th class="q-header">Question</th>
                <th>Reply</th>
                <th>Username</th>
              </tr>
            </thead>
          <tbody> 
            <tr id="{{QUESTION-ID}}" class="hide" onclick = "showQuestion('{{QUESTION-ID}}');">
              <td class="q-icon">
                  <img src = "questionMark-Math.png" style="padding-right: 15px; ">
                  <span>{{QUESTION}}</span>
                  <!-- <a href="page3-Math.html" class = "q-a" style="left:0px">{{QUESTION}}</a> -->
              </td>
              <td>{{REPLY}}</td>
              <td>{{AUTHOR}}</td>
            </tr>
          </tbody>
        </table>
        <input class="question-title" type = "text"  placeholder="Creat your question...">
        <input class="question-detail" type = "text"  placeholder="Detail here...">
        <button onclick="AddQuestion('{{SUBJECT}}')">Create</button>
      </section>
      <div id="subjectData"></div>
    </div>

<!-- create question part-->
    <div class="page create-question">
      <link rel="stylesheet" href="./page3.css"/>
      <script src = "page2.js"></script>
      <section>
        <h2 class="create-question-title">Create Question</h2>
        <hr>
      </section>

      <section id="selectSubject">
        
        <h2 id="selectSubject" >Select Subject: </h2>
        <div class="form_radio_btn1">
          <input id="radio-1" type="radio" name="radio" value="1" onclick="selectAssignValue(1)" >
          <label for="radio-1">Math</label>
        </div>
        
        <div class="form_radio_btn2">
          <input id="radio-2" type="radio" name="radio" value="2" onclick="selectAssignValue(2)">
          <label for="radio-2">English</label>
        </div>

        <h2 id="questionTitle">Title</h2>
        <input class="input-text-question" type = "text"  id = "QuestionTextInput" placeholder="Creat title...">
        
      </section>

      <section id="detail">
        <h2 style="margin-left:20px;">Detail:</h2>
        <!-- <input type = "textarea" id="ansTextInput" name="answer" rows="4" cols="50"> -->
        <textarea id="detailTextInput" name="answer" rows="4" cols="80" placeholder="Write detail...">

          </textarea>
        <!-- <input type = "button" value = "submit1" onclick="CreatAnswer()" /> -->
        
      </section>
      <section>

        <hr>
      </section>

      <section id="lastButton">
        <button id="finishButton" onclick="finishQuestion()">Finish</button>
        <button id="cancelButton" onclick="cancel()">Cancel</button>
      </section>
    </div>



<!-- answer part -->

    <div class = "page q-page">
      <link rel="stylesheet" href="page3.css" />
      <section>
        <h2 class="title" id="q_subject">{{SUBJECT}}<span>.</span></h2>
        <hr style="margin-bottom: -10px; border: 1px solid grey;">
      </section>

      <section>
        <h2 class="section-title" >
          <img src = "questionMark-Math.png">
          <span id="q_text">{{QUESTION_TEXT}}</span>
        </h2>
        <br>
        
        <p class="paraQuestion" id="q_detail">{{QUESTION_DETAIL}}</p>
        <h3 style="text-align: right; font-size:1.5rem;" id="q_author">{{AUTHOR}}</h3>
        <hr style="margin-bottom: -10px; border: 1px solid grey;">
      </section>
          
      <section id = "detail" style="margin-top: -40px; margin-bottom: -30px;">
        <h2 class="section-answer">Reply</h2>
        <textarea id="ansTextInput" name="answer" rows="5" cols="90" placeholder="Reply..."></textarea>
        <input type = "button" value = "submit" style = "margin-left: 20px; height: 25px;" onclick="AddAnswer()" />
      </section>

      <section id ="ReplyList">
        <table class = "ans-template hide" id = "mrtable">
          <thead>
            <th id = "math"><font style="color: blue;">Ansx</font></th>
            <th id = "muth">{{ANS-AUTHOR}}</th>
          </thead>
            
          <tbody>
            <td id = "matd" colspan="2" ><p>{{ANS-TEXT}}</p></tr>
          </tbody>
        </table>
        <div class="data"></div>
      </section>

      <section style="text-align: right;" >
        <img src = "home.png" height="50px" width="50px" onclick=" toHome();">
      </section>

    </div>   
  
<!-- javascript part-->

<script type="module" src ="home.js"></script>    
<script>
     
var userName = "";
var gQuestion = {};
var gID ;

// function mainPage(){
//   toHome();
  
//   document.querySelector(".home-page").classList.remove("open");
//   document.querySelector(".main-page").classList.add("open");
//   document.querySelector(".question").classList.add("open");
// }
function UICreateSubject(subject)
{
    console.log(subject);
    var section = document.querySelector("section.subject");
    var newSection = section.cloneNode(true);
    newSection.classList.remove("hide");
    var strHTML = newSection.outerHTML;
    strHTML = strHTML.replaceAll("{{SUBJECT}}",subject);
    
    var body = document.querySelector("#subjectData");
    body.insertAdjacentHTML('beforeend', strHTML );
}

function UICreateQuestion(subject,question,reply,author,qID){
  console.log("UICreateQuestion",subject,question,reply,author,qID);
    var tbody = document.querySelector("#" + subject + " .tab-data tbody");
    var tr = tbody.querySelector(".hide");

    var newTr = tr.cloneNode(true);
    newTr.classList.remove("hide");


    var strHTML = newTr.outerHTML;
    strHTML = strHTML.replaceAll("{{QUESTION}}",question);
    strHTML = strHTML.replaceAll("{{REPLY}}",reply);
    strHTML = strHTML.replaceAll("{{AUTHOR}}",author);
    strHTML = strHTML.replaceAll("{{QUESTION-ID}}",qID);

    tbody.insertAdjacentHTML('beforeend', strHTML );
    
    console.log(tr);
}
async function AddQuestion(subject){
    var title = document.querySelector("#" + subject + " .question-title").value;
    var detail = document.querySelector("#" + subject + " .question-detail").value;
    title = title.trim();
    detail = detail.trim();
    if( title != ""){
    
      console.log(title,detail);
      var x = await addquestion({question_txt:title,subject:subject,detail:detail,author:userName});
      console.log(x);
      UICreateQuestion(subject,title,0,userName,x);
      document.querySelector("#" + subject + " .question-title").value = "";
      document.querySelector("#" + subject + " .question-detail").value = "";
    }
    
}

function UICreateAnswer(obj){
    // var ans_arr = document.querySelector("#ReplyList");
    // console.log(ans_arr);
    
    var ans_template = document.querySelector("#ReplyList .ans-template ");
    console.log(ans_template);

    var ans = ans_template.cloneNode(true);
    ans.classList.remove("hide");


    var strHTML = ans.outerHTML;
    strHTML = strHTML.replaceAll("{{ANS-TEXT}}",obj.text);
    strHTML = strHTML.replaceAll("{{ANS-AUTHOR}}",obj.author);

    var addplace = document.querySelector("#ReplyList .data");
    console.log(addplace);
    addplace.insertAdjacentHTML('beforeend', strHTML );
    
    console.log(ans_template);
}
function AddAnswer(){
    var ans_text = document.querySelector("#ansTextInput").value;
    ans_text = ans_text.trim();
    if(ans_text !=""){
      console.log(ans_text);
      addanswer({question_id:gID,author:userName,anstext:ans_text});
      UICreateAnswer({text:ans_text,author:userName});
      document.querySelector("#ansTextInput").value = "";
    }
    
    
}
// AddAnswer()
function toHome(){
  
  onload();
  console.log("toHome");
    document.querySelector(".q-page").classList.remove("open");
    document.querySelector(".main-page").classList.add("open");
}
function toHomefromlogin(){
  
  onload();
  
  console.log("toHomefrom login");
    document.querySelector(".home-page").classList.remove("open");
    document.querySelector("#login").innerHTML = '';
    document.querySelector(".main-page").classList.add("open");
}

function CreateQuestion(){
  document.querySelector(".main-page").classList.remove("open");
  document.querySelector(".create-question").classList.add("open");
}

async function showQuestion(qID){
    gID = qID;
    console.log("showQuestion", qID);
    document.querySelector(".main-page").classList.remove("open");
    document.querySelector(".q-page").classList.add("open");
    var question=await getquestion({question_id:qID});
    question = {subject:'N/A',text:'N/A',detail:'N/A',author:'N/A', ... question};
    UIClearAnswer();
    var answers = question.ans;
    for(var ans in answers){
        console.log("ans", answers[ans]);
        UICreateAnswer(answers[ans]);
    }
    document.querySelector("#q_subject").innerHTML = question.subject;    
    document.querySelector("#q_text").innerHTML = question.text;
    document.querySelector("#q_detail").innerHTML = question.detail;
    document.querySelector("#q_author").innerHTML = question.author;
    
}
function UIClearAnswer(){
    var ans_arr = document.querySelector(" #ReplyList .data");
    ans_arr.innerHTML = '';
    // console.log(ans_template);
}

async function loadSubject(){
  var subjects = await getallsubject();
  console.log("test()",subjects);  
  for(var item in subjects){
      UICreateSubject(item);
      var questions = await getallquestion({
          subject:item,
      });
      console.log(item,questions);
      for(var q in questions){
         var question = questions[q];
         question = { ans:[],author:Date.now(), ... question};
         UICreateQuestion(question.subject,question.text,question.ans.length,question.author,q);
      }
  }
  
}
function refresh(){
  console.log("refresh");
  loadSubject();
}
function onload(){
  console.log("onload");
  // login
  document.querySelector("#subjectData").innerHTML = '';
  
  //set user name 
  document.querySelector("#user-name").innerHTML = userName;
  
  loadSubject();
}
function changeUsername(){
  var name = document.querySelector(".nnninputusername").value;
  name = name.trim();
  if(name != ""){
    userName = name;
    console.log(userName,"  name", name);
    toHomefromlogin();
  }
  else{
    UIAlert("enter your username first!!!!")
  }
}
function UIAlert(msg){
  alert(msg);
}

</script>
<script src = "page2.js" ></script>
</body>
</html>